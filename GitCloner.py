#GitCloner is a python based utility to cloning mutiple repos
#This is particualrly useful, while dealing with source code of Microservices
#Usage python GitCloner.py File_URLS_.txt

#Currently its pretty Raw, It takes a text file and extracts all http URL's from the file and 

#Replace the Git URL's SSH clone Command
#Then Clones the repos 
#Todo Clean the code and make it generic





import re
import os
import sys

#importing the file name 
file_name = os.path.abspath(sys.argv[1])

#print(file_name)
#opening the File with read priv
file_d = open(file_name, "r")
#storing the into a list , splitlines will make sure that \n characterr will be skipped 

data = file_d.read().splitlines()

#converting the list to string . as the List is containing mix data types..iterating to join and convert
#to string

data_s = ' '.join([str(elem) for elem in data]) 

#print(data_s)  

# got the regex for links from   and https://medium.com/@macxima

link_regex = re.compile('((https?):((//)|(\\\\))+([\w\d:#@%/;$()~_?\+-=\\\.&](#!)?)*)', re.DOTALL)

#extracting the raw links and storing in list 
links = re.findall(link_regex, data_s)
#creating new list to store clean URL's 
final_list=[]
#print(links)
for lnk in links:
	#print(lnk[0])
	final_list.append(lnk[0])

#print(final_list)

#ssh://git@gitrepo.domain.com:2222/XX/XX-XX/XX-XX.git
#https://XX.us.XXXXXX.com/XX/XX-XX/XXXX

git1 = [sub.replace('https://XXXX.us.XXX.com', 'ssh://git@XXX.us.XXXX.com:2222') for sub in final_list] 

#print(git1)

#print ( git clone $URL1 )

#adding git at end of the url

app_str='.git'
app_str1="git clone "

git2 = [sub + app_str for sub in git1]

#print(git2)

final_git = [app_str1 + sub for sub in git2]

#this above will print the proper ssh command by adding prefix to final_git list

#print(final_git)

for command in final_git:
	os.system(command)

